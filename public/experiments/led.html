<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LED Font Animation</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 1px solid #333;
            background: #000;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = 1200;
        canvas.height = 400;

        // Load the font
        const font = new FontFace('Doto', 'url(/fonts/Doto-Medium.ttf)');
        
        font.load().then((loadedFont) => {
            document.fonts.add(loadedFont);
            startAnimation();
        }).catch((error) => {
            console.error('Font loading failed:', error);
        });

        const text = 'Hello World';
        const fontSize = 120;
        const squareSize = 8; // Approximate size of each LED square in the font
        const colors = [
            '#FF0000', '#FF3300', '#FF6600', '#FF9900', '#FFCC00', '#FFFF00',
            '#CCFF00', '#99FF00', '#66FF00', '#33FF00', '#00FF00', '#00FF33',
            '#00FF66', '#00FF99', '#00FFCC', '#00FFFF', '#00CCFF', '#0099FF',
            '#0066FF', '#0033FF', '#0000FF', '#3300FF', '#6600FF', '#9900FF',
            '#CC00FF', '#FF00FF', '#FF00CC', '#FF0099', '#FF0066', '#FF0033'
        ];

        let dots = [];
        let animationFrame = 0;

        function startAnimation() {
            // First, render the text to detect dot positions
            ctx.fillStyle = '#FFFFFF';
            ctx.font = `${fontSize}px Doto`;
            ctx.textBaseline = 'middle';
            
            const textWidth = ctx.measureText(text).width;
            const x = (canvas.width - textWidth) / 2;
            const y = canvas.height / 2;
            
            ctx.fillText(text, x, y);

            // Scan the canvas to find all the dot squares
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            const visited = new Set();
            
            // Scan in a grid matching the square size
            for (let py = 0; py < canvas.height; py += squareSize) {
                for (let px = 0; px < canvas.width; px += squareSize) {
                    const key = `${px},${py}`;
                    if (visited.has(key)) continue;
                    
                    // Check if this region has white pixels
                    let hasWhite = false;
                    let sumX = 0, sumY = 0, count = 0;
                    
                    for (let dy = 0; dy < squareSize && !hasWhite; dy++) {
                        for (let dx = 0; dx < squareSize; dx++) {
                            const checkX = px + dx;
                            const checkY = py + dy;
                            if (checkX >= canvas.width || checkY >= canvas.height) continue;
                            
                            const index = (checkY * canvas.width + checkX) * 4;
                            const r = data[index];
                            const g = data[index + 1];
                            const b = data[index + 2];
                            const a = data[index + 3];
                            
                            if (r > 200 && g > 200 && b > 200 && a > 200) {
                                hasWhite = true;
                                sumX += checkX;
                                sumY += checkY;
                                count++;
                            }
                        }
                    }
                    
                    // If we found white pixels, this is a dot square
                    if (hasWhite && count > 0) {
                        visited.add(key);
                        dots.push({
                            x: sumX / count, // Center of the detected pixels
                            y: sumY / count,
                            colorIndex: Math.floor(Math.random() * colors.length),
                            colorSpeed: 0.05 + Math.random() * 0.1,
                            brightness: Math.random()
                        });
                    }
                }
            }

            // Start the animation loop
            animate();
        }

        function animate() {
            // Clear canvas
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw each dot with animated color
            dots.forEach(dot => {
                // Update color index smoothly
                dot.colorIndex += dot.colorSpeed;
                if (dot.colorIndex >= colors.length) {
                    dot.colorIndex = 0;
                }
                
                // Pulse brightness
                dot.brightness += 0.05;
                const brightness = (Math.sin(dot.brightness) + 1) / 2 * 0.5 + 0.5; // Range 0.5 to 1
                
                const color = colors[Math.floor(dot.colorIndex)];
                
                // Apply brightness by adjusting alpha
                ctx.fillStyle = color;
                ctx.globalAlpha = brightness;
                
                // Draw the dot with slight glow
                ctx.beginPath();
                ctx.arc(dot.x, dot.y, squareSize * 0.3, 0, Math.PI * 2);
                ctx.fill();
                
                // Add glow effect
                ctx.globalAlpha = brightness * 0.3;
                ctx.beginPath();
                ctx.arc(dot.x, dot.y, squareSize * 0.5, 0, Math.PI * 2);
                ctx.fill();
            });

            ctx.globalAlpha = 1.0;
            animationFrame++;
            requestAnimationFrame(animate);
        }
    </script>
</body>
</html>