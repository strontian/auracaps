<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js - 3D Text with Galaxy Texture</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            margin: 0;
            font-family: Monospace;
            background-color: #000;
            color: #fff;
            overflow: hidden;
        }
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 8px;
            z-index: 100;
        }
        .control-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        input[type="range"] {
            width: 200px;
        }
        .value-display {
            display: inline-block;
            margin-left: 10px;
            color: #00ffff;
        }
        select {
            width: 200px;
            padding: 5px;
            background: #222;
            color: #fff;
            border: 1px solid #444;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="controls">
        <div class="control-group">
            <label>Text Size: <span class="value-display" id="sizeValue">12</span></label>
            <input type="range" id="sizeSlider" min="0.5" max="25" value="12" step="0.5">
        </div>
        <div class="control-group">
            <label>Lighting Mode:</label>
            <select id="lightingMode">
                <option value="galaxy">Galaxy</option>
                <option value="neon">Neon Club</option>
                <option value="sunset">Sunset</option>
                <option value="arctic">Arctic</option>
                <option value="fire">Fire</option>
            </select>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';
        import { FontLoader } from 'three/addons/loaders/FontLoader.js';

        let renderer, scene, camera, controls;
        let textMesh, font, texture;
        let lights = {};

        init();

        function init() {
            // Camera setup
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 100;
            camera.position.y = 20;

            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111111);

            // Create canvas for galaxy texture
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 512;

            // Create galaxy texture
            const gradient = ctx.createRadialGradient(256, 256, 0, 256, 256, 400);
            gradient.addColorStop(0, '#4a148c');
            gradient.addColorStop(0.5, '#1a237e');
            gradient.addColorStop(1, '#000000');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Stars
            for (let i = 0; i < 200; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const size = Math.random() * 2;
                ctx.fillStyle = `rgba(255, 255, 255, ${Math.random()})`;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }

            // Nebula clouds
            for (let i = 0; i < 5; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const nebula = ctx.createRadialGradient(x, y, 0, x, y, 100);
                const colors = ['rgba(138, 43, 226, 0.3)', 'rgba(75, 0, 130, 0.3)', 'rgba(255, 20, 147, 0.3)'];
                nebula.addColorStop(0, colors[i % colors.length]);
                nebula.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.fillStyle = nebula;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            // Create texture
            texture = new THREE.CanvasTexture(canvas);
            texture.colorSpace = THREE.SRGBColorSpace;
            texture.wrapS = THREE.RepeatWrapping;
            texture.wrapT = THREE.RepeatWrapping;
            texture.repeat.set(0.05, 0.05);

            // Setup lights
            setupLights();

            // Load font and create 3D text
            const loader = new FontLoader();
            loader.load('https://cdn.jsdelivr.net/npm/three@0.170.0/examples/fonts/helvetiker_bold.typeface.json', function(loadedFont) {
                font = loadedFont;
                createText(12);
            });

            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setAnimationLoop(animate);
            document.body.appendChild(renderer.domElement);

            // Controls
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // Handle window resize
            window.addEventListener('resize', onWindowResize);

            // Setup UI controls
            setupUIControls();
        }

        function setupLights() {
            // Ambient light
            lights.ambient = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(lights.ambient);

            // Directional light
            lights.directional = new THREE.DirectionalLight(0xffffff, 1);
            lights.directional.position.set(10, 10, 10);
            scene.add(lights.directional);

            // Point light 1
            lights.point1 = new THREE.PointLight(0xff00ff, 1, 100);
            lights.point1.position.set(-10, 10, 10);
            scene.add(lights.point1);

            // Point light 2
            lights.point2 = new THREE.PointLight(0x00ffff, 1, 100);
            lights.point2.position.set(10, -10, 10);
            scene.add(lights.point2);

            // Additional point lights for different modes
            lights.point3 = new THREE.PointLight(0xff0000, 0, 100);
            lights.point3.position.set(0, 0, 20);
            scene.add(lights.point3);

            lights.point4 = new THREE.PointLight(0x00ff00, 0, 100);
            lights.point4.position.set(-20, 0, 0);
            scene.add(lights.point4);
        }

        function setLightingMode(mode) {
            switch(mode) {
                case 'galaxy':
                    lights.ambient.intensity = 0.5;
                    lights.directional.intensity = 1;
                    lights.directional.color.setHex(0xffffff);
                    lights.point1.intensity = 1;
                    lights.point1.color.setHex(0xff00ff);
                    lights.point2.intensity = 1;
                    lights.point2.color.setHex(0x00ffff);
                    lights.point3.intensity = 0;
                    lights.point4.intensity = 0;
                    scene.background.setHex(0x111111);
                    break;

                case 'neon':
                    lights.ambient.intensity = 0.2;
                    lights.directional.intensity = 0.3;
                    lights.directional.color.setHex(0x8800ff);
                    lights.point1.intensity = 2;
                    lights.point1.color.setHex(0xff0088);
                    lights.point2.intensity = 2;
                    lights.point2.color.setHex(0x00ffff);
                    lights.point3.intensity = 1.5;
                    lights.point3.color.setHex(0xff00ff);
                    lights.point4.intensity = 1.5;
                    lights.point4.color.setHex(0x00ff88);
                    scene.background.setHex(0x050510);
                    break;

                case 'sunset':
                    lights.ambient.intensity = 0.6;
                    lights.directional.intensity = 1.5;
                    lights.directional.color.setHex(0xff6600);
                    lights.point1.intensity = 1.2;
                    lights.point1.color.setHex(0xff3300);
                    lights.point2.intensity = 1;
                    lights.point2.color.setHex(0xff9900);
                    lights.point3.intensity = 0.8;
                    lights.point3.color.setHex(0xff6600);
                    lights.point4.intensity = 0;
                    scene.background.setHex(0x1a0a05);
                    break;

                case 'arctic':
                    lights.ambient.intensity = 0.7;
                    lights.directional.intensity = 1.2;
                    lights.directional.color.setHex(0xccffff);
                    lights.point1.intensity = 1.5;
                    lights.point1.color.setHex(0x00ffff);
                    lights.point2.intensity = 1.5;
                    lights.point2.color.setHex(0x88ccff);
                    lights.point3.intensity = 1;
                    lights.point3.color.setHex(0xaaffff);
                    lights.point4.intensity = 0.5;
                    lights.point4.color.setHex(0xffffff);
                    scene.background.setHex(0x0a1520);
                    break;

                case 'fire':
                    lights.ambient.intensity = 0.3;
                    lights.directional.intensity = 0.5;
                    lights.directional.color.setHex(0xff3300);
                    lights.point1.intensity = 2;
                    lights.point1.color.setHex(0xff0000);
                    lights.point2.intensity = 1.5;
                    lights.point2.color.setHex(0xff6600);
                    lights.point3.intensity = 2;
                    lights.point3.color.setHex(0xff9900);
                    lights.point4.intensity = 1;
                    lights.point4.color.setHex(0xffcc00);
                    scene.background.setHex(0x100505);
                    break;
            }
        }

        function createText(size) {
            // Remove old text mesh if it exists
            if (textMesh) {
                scene.remove(textMesh);
                textMesh.geometry.dispose();
            }

            const textGeometry = new TextGeometry('Hello World!', {
                font: font,
                size: size,
                depth: size * 0.21,
                curveSegments: 12,
                bevelEnabled: true,
                bevelThickness: size * 0.14,
                bevelSize: size * 0.06,
                bevelOffset: 0,
                bevelSegments: 5
            });

            textGeometry.center();

            const textMaterial = new THREE.MeshStandardMaterial({
                map: texture,
                roughness: 0.3,
                metalness: 0.2
            });

            textMesh = new THREE.Mesh(textGeometry, textMaterial);
            scene.add(textMesh);
        }

        function setupUIControls() {
            const sizeSlider = document.getElementById('sizeSlider');
            const sizeValue = document.getElementById('sizeValue');
            const lightingMode = document.getElementById('lightingMode');

            sizeSlider.addEventListener('input', (e) => {
                const size = parseFloat(e.target.value);
                sizeValue.textContent = size;
                if (font) {
                    createText(size);
                }
            });

            lightingMode.addEventListener('change', (e) => {
                setLightingMode(e.target.value);
            });

            // Set initial lighting
            setLightingMode('galaxy');
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            controls.update();
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>